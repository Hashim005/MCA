{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search Form</title>
  <!-- Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <!-- Select2 CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <!-- Bootstrap JS, Popper.js, and jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <!-- Select2 JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <style>
    body {
      display: flex;
      min-height: 100vh;
      justify-content: center;
      align-items: center;
      margin: 0;
      /* Set multiple background images */
      background-image: url('/static/MainApp/images/bus_booking3.jpg'), 
                        url('/static/MainApp/images/bus_booking4.jpg');
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
    }

    .search_panel {
      width: 80%;
    }

    .search_item {
      margin-bottom: 10px;
      display: flex;
      flex-direction: column; /* Display children (label and input/select) in a column */
    }

    /* Custom CSS for Select2 */
    .select2-container--bootstrap4 .select2-selection--single {
      background-color: white;
      border: 1px solid #ced4da;
      border-radius: 0.25rem;
      height: calc(2.25rem + 2px);
      padding: 0.375rem 0.75rem;
      width: 100%; /* Set the width to 100% or adjust as needed */
      min-width: 200px; /* Set a minimum width if needed */
    }

    /* Adjust the width of the container to make the dropdown wider */
    .select2-container--bootstrap4 .select2-selection--single .select2-selection__arrow {
      height: calc(2.25rem + 2px);
    }

    /* Hide error messages initially */
    .form-text.text-danger {
      display: none;
    }

  </style>
</head>
<body>

<div class="container search_panel">
  <form action="{% url "schedule_view_page" %}" id="search_form_2" class="search_panel_content d-flex flex-wrap justify-content-between align-items-center">
    {% csrf_token %}
    <div class="search_item">
      <label for="depart">Depart</label>
      <select name="depart" id="depart" class="form-select select2 rounded-0">
        <option selected></option>
        {% for location in locations %}
        <option value="{{ location.id }}">{{ location }}</option>
        {% endfor %}
      </select>
      <span id="departError" class="form-text text-danger">Please select a location</span>
    </div>
    <div class="search_item">
      <label for="destination">Destination</label>
      <select name="destination" id="destination" class="form-select select2 rounded-0">
        <option selected></option>
        {% for location in locations %}
        <option value="{{ location.id }}">{{ location }}</option>
        {% endfor %}
      </select>
      <span id="destinationError" class="form-text text-danger">Please select a location</span>
    </div>
    <div class="search_item">
      <label for="journeyDate">Journey Date</label>
      <input type="date" id="journeyDate" class="check_in search_input form-control" min="{{ today }}" required="required">
      <span id="journeyDateHelp" class="form-text text-danger">Invalid journey date</span>
    </div>
    <div class="search_item">
      <label for="returnDate">Return Date (optional)</label>
      <input type="date" id="returnDate" class="check_out search_input form-control" min="{{ today }}">
      <span id="returnDateHelp" class="form-text text-danger">Invalid return date</span>
    </div>

    <button type="submit" class="btn btn-primary search_button">Search</button>
  </form>
</div>

<!-- Bootstrap JS, Popper.js, and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script>
  $(document).ready(function() {
    // Initialize Select2 for the "Depart" field
    $('#depart').select2({
      placeholder: 'Select location',
      allowClear: true,
      theme: 'bootstrap4',
    });
    $('#destination').select2({
      placeholder: 'Select location',
      allowClear: true,
      theme: 'bootstrap4',
    });

    // Array of background images
    var images = [
        '/static/MainApp/images/bus_booking4.jpg',
        '/static/MainApp/images/bus_booking3.jpg',
        // Add more image URLs as needed
    ];

    var currentImageIndex = 0;

    // Function to change the background image
    function changeBackground() {
        $('body').css('background-image', 'url("' + images[currentImageIndex] + '")');
        currentImageIndex = (currentImageIndex + 1) % images.length;
    }

    // Change the background image every 5 seconds (adjust as needed)
    setInterval(changeBackground, 5000);

    // Hide error messages initially
    $('.form-text.text-danger').hide();

    // Show error messages only on user interaction
    $('#depart').change(function() {
      validateDepart();
      validateSameLocation();
    });

    $('#destination').change(function() {
      validateDestination();
      validateSameLocation();
    });

    $('#journeyDate').change(function() {
      validateJourneyDate();
    });

    $('#returnDate').change(function() {
      validateReturnDate();
    });

    // Validate form before submission
    $('#search_form_2').submit(function(event) {
      // Validate Depart field
      validateDepart();

      // Validate Destination field
      validateDestination();

      // Validate date fields
      validateJourneyDate();
      validateReturnDate();

      // Validate same location
      validateSameLocation();

      // Prevent form submission if there are errors
      if ($('.form-text.text-danger:visible').length > 0) {
        event.preventDefault();
      }
    });

    function validateDepart() {
      var departValue = $('#depart').val();
      if (!departValue) {
        $('#departError').show();
      } else {
        $('#departError').hide();
      }
    }

    function validateDestination() {
      var destinationValue = $('#destination').val();
      if (!destinationValue) {
        $('#destinationError').show();
      } else {
        $('#destinationError').hide();
      }
    }

    function validateJourneyDate() {
      var journeyDate = new Date($('#journeyDate').val());
      var oneMonthLater = new Date();
      oneMonthLater.setMonth(oneMonthLater.getMonth() + 1);

      if (journeyDate > oneMonthLater) {
        $('#journeyDateHelp').show();
      } else {
        $('#journeyDateHelp').hide();
      }
    }

    function validateReturnDate() {
      var journeyDate = new Date($('#journeyDate').val());
      var returnDate = new Date($('#returnDate').val());

      if (returnDate && returnDate <= journeyDate) {
        $('#returnDateHelp').show();
      } else {
        $('#returnDateHelp').hide();
      }
    }

    function validateSameLocation() {
      var departValue = $('#depart').val();
      var destinationValue = $('#destination').val();

      if (departValue && destinationValue && departValue === destinationValue) {
        $('#departError').text('cannot be same');
        $('#departError').show();
      } else {
        $('#departError').hide();
      }
    }
  });
</script>
</body>
</html>
